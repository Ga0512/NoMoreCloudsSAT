<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Satellite Image Compositor</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Leaflet Draw CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
    <!-- Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="app-container">

        <!-- ‚ïê‚ïê‚ïê Header ‚ïê‚ïê‚ïê -->
        <header class="header">
            <h1><span>üõ∞Ô∏è</span> Satellite Image Compositor</h1>
            <div class="auth-indicators" id="authIndicators">
                <span><span class="auth-dot disconnected" id="dotGee"></span>GEE</span>
                <span><span class="auth-dot disconnected" id="dotCopernicus"></span>Copernicus</span>
                <span><span class="auth-dot connected" id="dotPlanetary"></span>Planetary</span>
            </div>
        </header>

        <!-- ‚ïê‚ïê‚ïê Sidebar ‚ïê‚ïê‚ïê -->
        <aside class="sidebar">

            <!-- Autentica√ß√£o -->
            <div class="panel">
                <div class="panel-header">üîë Autentica√ß√£o</div>
                <div class="btn-group">
                    <button class="btn btn-secondary btn-sm" onclick="authGee()">Login GEE</button>
                    <button class="btn btn-secondary btn-sm" onclick="authCopernicus()">Login Copernicus</button>
                </div>
                <label for="geeProject">Projeto GEE (opcional)</label>
                <input type="text" id="geeProject" placeholder="ex: my-gee-project">
            </div>

            <!-- Provedor -->
            <div class="panel">
                <div class="panel-header">üì° Provedor</div>
                <select id="provider" onchange="onProviderChange()">
                    <option value="gee_sentinel">GEE ‚Äî Sentinel-2 (10m)</option>
                    <option value="gee_landsat">GEE ‚Äî Landsat 8/9 (30m)</option>
                    <option value="copernicus">Copernicus OpenEO ‚Äî Sentinel-2</option>
                    <option value="planetary">Planetary Computer ‚Äî Landsat 8/9</option>
                </select>
            </div>

            <!-- AOI -->
            <div class="panel">
                <div class="panel-header">üìç √Åreas de Interesse (AOI)</div>
                <p style="font-size:12px; color:var(--text-muted); margin-bottom:8px">
                    Adicione v√°rias AOIs: desenhe no mapa, insira BBOX ou fa√ßa upload.
                    Cada AOI gera um job separado ao processar.
                </p>

                <label>BBOX (west, south, east, north)</label>
                <div class="input-row">
                    <input type="number" id="bboxWest" step="0.01" placeholder="West (lon)">
                    <input type="number" id="bboxSouth" step="0.01" placeholder="South (lat)">
                </div>
                <div class="input-row" style="margin-top:4px">
                    <input type="number" id="bboxEast" step="0.01" placeholder="East (lon)">
                    <input type="number" id="bboxNorth" step="0.01" placeholder="North (lat)">
                </div>
                <label for="aoiName">Nome da AOI (opcional)</label>
                <input type="text" id="aoiName" placeholder="ex: Campinas, Fazenda Norte...">
                <button class="btn btn-secondary btn-sm" style="margin-top:8px" onclick="addBboxAoi()">
                    ‚ûï Adicionar BBOX
                </button>

                <div class="file-upload" onclick="document.getElementById('shapefileInput').click()">
                    <input type="file" id="shapefileInput" accept=".zip,.geojson,.json" onchange="uploadShapefile(event)">
                    <p>üìÇ Upload Shapefile (.zip) ou GeoJSON</p>
                </div>

                <!-- Lista de AOIs adicionadas -->
                <div id="aoiList" style="margin-top:10px"></div>

                <div class="btn-group" style="margin-top:6px">
                    <button class="btn btn-secondary btn-sm" onclick="clearAllAois()" title="Remove todas as AOIs">
                        üóëÔ∏è Limpar Todas
                    </button>
                    <button class="btn btn-secondary btn-sm" onclick="fitAllAois()" title="Zoom para todas as AOIs">
                        üîç Ver Todas
                    </button>
                </div>
            </div>

            <!-- Par√¢metros -->
            <div class="panel">
                <div class="panel-header">‚öôÔ∏è Par√¢metros</div>

                <div class="input-row">
                    <div>
                        <label for="startDate">Data Inicial</label>
                        <input type="date" id="startDate" value="2024-01-01">
                    </div>
                    <div>
                        <label for="endDate">Data Final</label>
                        <input type="date" id="endDate" value="2024-06-30">
                    </div>
                </div>

                <label for="bands">Bandas (separadas por v√≠rgula)</label>
                <input type="text" id="bands" placeholder="deixe vazio para padr√£o">

                <div class="input-row">
                    <div>
                        <label for="resolution">Resolu√ß√£o (m)</label>
                        <input type="number" id="resolution" placeholder="auto" min="1">
                    </div>
                    <div>
                        <label for="maxCloud">Nuvens M√°x. (%)</label>
                        <input type="number" id="maxCloud" value="30" min="0" max="100">
                    </div>
                </div>

                <div id="cloudProbContainer">
                    <label for="cloudProb">Cloud Prob Threshold (%) ‚Äî GEE Sentinel</label>
                    <input type="number" id="cloudProb" value="50" min="0" max="100">
                </div>
            </div>

            <!-- Executar -->
            <div class="panel">
                <button class="btn btn-primary" id="btnProcess" onclick="startProcessing()">
                    üöÄ Processar Todas as AOIs
                </button>
                <p id="aoiCount" style="font-size:11px;color:var(--text-muted);text-align:center;margin-top:4px"></p>
            </div>

            <!-- GeoJSON preview -->
            <div class="panel">
                <div class="panel-header">üó∫Ô∏è AOI GeoJSON (selecionada)</div>
                <textarea id="aoiPreview" rows="4" readonly placeholder="Clique numa AOI para ver o GeoJSON"></textarea>
            </div>

            <!-- Jobs -->
            <div class="panel">
                <div class="panel-header">üìã Hist√≥rico de Jobs</div>
                <div id="jobsList"></div>
            </div>

        </aside>

        <!-- ‚ïê‚ïê‚ïê Map ‚ïê‚ïê‚ïê -->
        <div class="map-container">
            <div id="map"></div>
        </div>

    </div>

    <!-- Toast container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <script src="/js/app.js"></script>
</body>
</html>
